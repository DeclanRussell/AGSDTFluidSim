//----------------------------------------------------------------------------------------------------------------------
/// @file particleDepthVert.glsl
/// @author Declan Russell
/// @date 8/03/15
/// @version 1.0
/// @namepsace GLSL
/// @class particleDepthVert
/// @brief Vertex shader for our particle depth shader. Takes in points of particles and scales the point sprite with
/// @brief the current scene projection matrix.
//----------------------------------------------------------------------------------------------------------------------

#version 400

//----------------------------------------------------------------------------------------------------------------------
/// @brief position of particles buffer
//----------------------------------------------------------------------------------------------------------------------
layout (location = 0) in vec3 vertexPosition;

//----------------------------------------------------------------------------------------------------------------------
/// @brief eye space position to be sent to fragment shader
//----------------------------------------------------------------------------------------------------------------------
out vec3 position;

//----------------------------------------------------------------------------------------------------------------------
/// @brief our projection matrix
//----------------------------------------------------------------------------------------------------------------------
uniform mat4 P;
//----------------------------------------------------------------------------------------------------------------------
/// @brief our model view matrix
//----------------------------------------------------------------------------------------------------------------------
uniform mat4 MV;
//----------------------------------------------------------------------------------------------------------------------
/// @brief our model view projection matrix
//----------------------------------------------------------------------------------------------------------------------
uniform mat4 MVP;
//----------------------------------------------------------------------------------------------------------------------
/// @brief the width of our screen
//----------------------------------------------------------------------------------------------------------------------
uniform int screenWidth;
//----------------------------------------------------------------------------------------------------------------------
/// @breif the size of our particles
//----------------------------------------------------------------------------------------------------------------------
uniform float pointSize;


//----------------------------------------------------------------------------------------------------------------------
/// @brief vertex main. Scales point sprites with projection matrix and passes through eye space postion to fragment shader
//----------------------------------------------------------------------------------------------------------------------
void main(){


    //scale the point sprite based on our projection matrix
    vec4 eyePos = MV * vec4(vertexPosition,1.0);
    position = vec3(eyePos);
    vec4 projCorner = P * vec4(0.5*pointSize, 0.5*pointSize, eyePos.z, eyePos.w);
    gl_PointSize = screenWidth * projCorner.x / projCorner.w;

    gl_Position = vec4(MVP * vec4(vertexPosition, 1.0));
}
